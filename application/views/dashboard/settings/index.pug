//- ====== Fieldset =====
mixin formFieldSet(name)
    fieldset
        legend 
            h4.theme-color.bold #{name}
        block

//- ===== Text =====
mixin formFieldText(name, lbl, max, ex, val, count)
    label.form-label(for=name) #{lbl}
    if max === FALSE
        input.form-input(type="text", name=name, placeholder=ex, autocomplete="off", value=val, id=name)
    else
        input.form-input(type="text", name=name, maxlength=max, placeholder=ex, autocomplete="off", value=val, id=name)
    if count !== FALSE
        span.text-counter(id=name."-ch-count")

//- ===== Textarea =====
mixin formFieldTextArea(name, lbl, max, ex, val, count)
    label.form-label(for=name) #{lbl}
    textarea.form-input(name=name, maxlength=max, rows="5", cols="40", placeholder=ex, autocomplete="off", id=name) #{val}
    if count !== FALSE
        span.text-counter(id=name."-ch-count")

//- ===== Radio =====
mixin formFieldRadio(name, lbl, selected, vals)
    label.form-label(for=name) #{lbl}
    each val, key in vals
        label.form-radio
            - var test = stripos(trim(strval(key)), trim(strval(selected)))
            if test === FALSE
                input(type="radio", name=name, value=key)
            else
                input(type="radio", name=name, value=key, checked)
            i.form-icon
            span #{val}
        br

extends ../../templates/dash_template.pug

append vars
    -var stylesheets = array()
    
append content
    #err #{validation_errors}

    //-if isset(dump_settings)
        pre !{dump_settings}

    form(method="post", action=baseUrl.page_action, enctype="multipart/form-data", accept-charset="utf-8")
        //- ===== General =====
        +formFieldSet("General")
            //- ===== Institution =====
            .form-group
                +formFieldText("institution", "Institution", max_length["institution"], "Ex. Toronto District School Board", settings->institution, TRUE)

        //- ===== Message =====
        +formFieldSet("Message")
            //- ===== Title =====
            .form-group
                +formFieldText("message[title]", "Title", max_length["title"], "Ex. Toronto District School Board", settings->message->title, TRUE)
            //- ===== Content =====
            .form-group
                +formFieldTextArea("message[content]", "Content", max_length["content"], "Ex. Education Nourishes Youth", settings->message->content, TRUE)
            .form-group
                input(type="file", name="message[image]", accept=image_file_types)
            if !empty(settings->message->image)
                .form-group
                    img(src=upload_path.(settings->message->image), style="height: 20vh; display: block;")
                    label.form-checkbox
                        input(type="checkbox", name="message[remove_image]", value=1)
                        i.form-icon
                        span Remove Image

        //- ===== Emergency Announcement =====
        +formFieldSet("Emergency Announcement")
            //- ===== Title =====
            .form-group
                +formFieldText("emergency[title]", "Title", max_length["title"], "Ex. Toronto District School Board", settings->emergency->title, TRUE)
            //- ===== Content =====
            .form-group
                +formFieldTextArea("emergency[content]", "Content", max_length["content"], "Ex. Education Nourishes Youth", settings->emergency->content, TRUE)
            .form-group
                label.form-label
                input.form-file(type="file", name="emergency[image]", accept=image_file_types)
            if !empty(settings->emergency->image)
                .form-group
                    img(src=upload_path.(settings->emergency->image), style="height: 20vh; display: block;")
                    label.form-checkbox
                        input(type="checkbox", name="emergency[remove_image]", value=1)
                        i.form-icon
                        span Remove Image

        //- ===== Colour =====
        +formFieldSet("Colour")
            //- ===== Foreground =====
            .form-group
                +formFieldText("colour[foreground]", "Foreground", FALSE, "Ex. #ffffff", settings->colour->foreground, FALSE)

            //- ===== Background =====
            .form-group
                +formFieldText("colour[background]", "Background", FALSE, "Ex. #000000", settings->colour->background, FALSE)

        //- ===== Location =====
        +formFieldSet("Location")
            //- ===== City =====
            .form-group
                +formFieldText("location[city]", "City", FALSE, "Ex. Toronto", settings->location->city, FALSE)

            //- ===== Country =====
            .form-group
                +formFieldText("location[country]", "Country", FALSE, "Ex. Canada", settings->location->country, FALSE)

            //- ===== Zip =====
            .form-group
                +formFieldText("location[zip]", "Postal/Zip Code", FALSE, "Ex. M4M2A1", settings->location->zip, FALSE)

        //- ===== Weather =====
        +formFieldSet("Weather")
            //- ===== Search =====
            .form-group
                +formFieldRadio("weather[search]", "Search Type", settings->weather->search, type_options['search'])

            //- ===== Units =====
            .form-group
                +formFieldRadio("weather[units]", "Unit Type", settings->weather->units, type_options['units'])

        //- ===== Content =====
        +formFieldSet("Content Scrolling")
            //- ===== Speed =====
            .form-group
                +formFieldText("content[speed]", "Speed [Seconds]", FALSE, "Ex. 10", settings->content->speed, FALSE)

        input.btn.btn-primary(type="submit", value="Update Settings")
    //- a(href=baseUrl."dashboard", title="Back to Dashboard") Back to Dashboard
append loadAfter
    link(rel="stylesheet", type="text/css", href=baseUrl."assets/vendor/text_counter/css/text-counter.css")
    script(src=baseUrl."assets/vendor/text_counter/js/text-counter.js")
    script.
        [
            {
                'field':        document.getElementById('institution'),
                'counter':      document.getElementById('institution-ch-count'),
                'max_length':   #{max_length["institution"]},
            },
            {
                'field':        document.getElementById('message[title]'),
                'counter':      document.getElementById('message[title]-ch-count'),
                'max_length':   #{$max_length["title"]},
            },
            {
                'field':        document.getElementById('message[content]'),
                'counter':      document.getElementById('message[content]-ch-count'),
                'max_length':   #{$max_length["content"]},
            },
            {
                'field':        document.getElementById('emergency[title]'),
                'counter':      document.getElementById('emergency[title]-ch-count'),
                'max_length':   #{$max_length["title"]},
            },
            {
                'field':        document.getElementById('emergency[content]'),
                'counter':      document.getElementById('emergency[content]-ch-count'),
                'max_length':   #{$max_length["content"]},
            }
        ].forEach(function(e, index){
            text_counter(e.field, e.counter, e.max_length);
        });